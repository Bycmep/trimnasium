<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Tool</title>
<style>
#imgSelect {
    position: absolute; left: 10vw; top: 5vh; padding: 1em;
    border: 1px solid black; width: 80vw;
    display: flex; flex-direction: column; align-items: center;
    #cropSpace { display: grid; place-items: center; width: 100%; height: 70%;
        img, svg { grid-column: 1; grid-row: 1; width: 100%; height: 75vh; object-fit: contain; }
    }
    button { margin: 0.4em; }
}


</style>
</head>
<body>
<script type="module">
"use strict";
import { Page } from "./lib/domchain.js";
import { PageParse } from './lib/domchainparse.js';
Page.prototype.parse = PageParse;
import { File } from "./lib/file4.js";
//import { Ajax } from "./lib/ajax.js";

Page.body.parse(`div#imgSelect { div#cropSpace { img#cropImage svg#cropSvg }
    button#cropOpen(Open) }`);

Page.$cropOpen.e.onclick = async () => {
    const input = await File.open({ types: [{ description: 'Image files',
        accept: { 'image/jpeg': ['.jpeg', '.jpg'], 'image/png': ['.png'] }}],
        excludeAcceptAllOption: true, multiple: false });
    const data = await input.readData();
    const image = Page.$cropImage, svg = Page.$cropSvg;
    image.set({ $src: data });
    image.e.onload = () => {
        const dx0 = image.e.naturalWidth, dy0 = image.e.naturalHeight,
            dx = image.e.width, dy = image.e.height;
        svg.set({ $width: dx, $height: dy });
        let crop_x = 0, crop_y = 0, size = Math.min(dx, dy);
        const d = () => { return `M${crop_x},${crop_y} h${size} v${size} h-${size}z`; };
        const frame = svg.insert("path").set({ $fill: 'yellow', $stroke: 'magenta', $d: d() });

    };

}

</script>
</body>
</html>